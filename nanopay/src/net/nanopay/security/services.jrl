p({"class":"foam.nanos.boot.NSpec", "name":"keyStoreManager",                  "serviceScript":"import net.nanopay.security.PKCS11KeyStoreManager;\nimport java.security.KeyStore;\nimport java.io.*;\n\nString hsmToken = null;\nBufferedReader br = new BufferedReader(new FileReader(\"/opt/nanopay/keys/547ca49cda2957dc997890d2d132d2c8\"));\n\nStringBuilder sb = new StringBuilder();\nString line = br.readLine();\n\nwhile (line != null) {\n  sb.append(line);\n  sb.append(System.lineSeparator());\n  line = br.readLine();\n}\n\nhsmToken = sb.toString().replaceAll(\"(\\\\r|\\\\n)\", \"\");\n\nreturn new PKCS11KeyStoreManager.Builder(x)\n  .setLoadStoreParameter(new KeyStore.LoadStoreParameter() {\n    public KeyStore.ProtectionParameter getProtectionParameter() {\n      return new KeyStore.PasswordProtection(hsmToken.toCharArray());\n    }\n}).build();"})
p({"class":"foam.nanos.boot.NSpec", "name":"CSPViolationsDAO",                 "serve":true,  "serviceScript":"return new foam.dao.EasyDAO.Builder(x).setJournalType(foam.dao.JournalType.SINGLE_JOURNAL).setSeqNo(true).setJournalName(\"CSPViolation\").setOf(net.nanopay.security.csp.CSPViolation.getOwnClassInfo()).build();", "client":"{\"of\":\"net.nanopay.security.csp.CSPViolation\"}", "description":"DAO containing CSP violation reports that are sent to the server by the clients."})

p({
  "class": "foam.nanos.boot.NSpec",
  "name": "CSPReportWebAgent",
  "authenticate": false,
  "serviceClass": "net.nanopay.security.csp.CSPReportWebAgent"
})

p({
  "class": "foam.nanos.boot.NSpec", 
  "name": "viewPIIRequestDAO",                
  "serve": true,  
  "serviceScript":
  """ 
    return new foam.dao.EasyDAO.Builder(x)
      .setOf(net.nanopay.security.pii.ViewPIIRequest.getOwnClassInfo())
      .setSeqNo(true)
      .setJournalName("viewPIIRequest")
      .setJournalType(foam.dao.JournalType.SINGLE_JOURNAL)
      .setDecorator(new net.nanopay.security.pii.AuthenticatedPIIRequestDAO(x, 
        new net.nanopay.security.pii.FreezeApprovedPIIRequestsDAO.Builder(x).setDelegate( 
        new net.nanopay.security.pii.PreventDuplicatePIIRequestsDAO.Builder(x).setDelegate(
        new net.nanopay.security.pii.ApprovedPIIRequestDAO.Builder(x).setDelegate(new foam.dao.NullDAO.Builder(x).setOf(net.nanopay.security.pii.ViewPIIRequest.getOwnClassInfo()).build()).build()).build()).build()))
      .build();
  """, 
  "client": "{\"of\":\"net.nanopay.security.pii.ViewPIIRequest\"}"
})

p({
  "class": "foam.nanos.boot.NSpec",
  "name": "PIIWebAgent",
  "serviceClass": "net.nanopay.security.pii.PIIWebAgent"
})
