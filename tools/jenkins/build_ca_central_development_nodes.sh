# -------------------------------------------------------------------------------------------------
# 05/21/21      Moorthy Rathinasamy       Initial Version
# -------------------------------------------------------------------------------------------------
#!/bin/bash

NODES=tools/medusa/ca-central-development-nodes
BUILD_FILE=ca-central-development-nodes-build.sh
SERVICE_HEALTH_URLS=tools/jenkins/services-ca-central-development-nodes

echo '********************************************************************************************'
echo '------------------------------------------- PRE-BUILD  -------------------------------------'
echo '********************************************************************************************'
echo 'Running Pre-build echecks ...'
tools/jenkins/pre_build.sh

echo '********************************************************************************************'
echo '------------------------------------------- BUILD  ------------------------------------------'
echo '********************************************************************************************'
echo 'Running base Build (with -i ) ...'
./build.sh -i
echo 'Running build [' $BUILD_FILE '] ...'
tools/medusa/$BUILD_FILE

echo '********************************************************************************************'
echo '------------------------------------------ PRE-DEPLOY  -------------------------------------'
echo '********************************************************************************************'
echo 'Running Node(s) Service Status Check ...'
tools/jenkins/pre_deploy.sh $NODES

echo '********************************************************************************************'
echo '-------------------------------------------- DEPLOY  ---------------------------------------'
echo '********************************************************************************************'
echo 'Running Nodes backup ...'
tools/medusa/backup-ledger.sh tools/medusa/ca-central-development-nodes
echo 'Running Remote Install/Deploy ...'
tools/jenkins/deploy.sh $NODES

echo '********************************************************************************************'
echo '----------------------------------------POST-DEPLOY  ---------------------------------------'
echo '********************************************************************************************'
echo 'Waiting three minutes to allow the services & health checks to be fully ready'
sleep 180
echo 'Running Post Deploy Checks ...' 
tools/jenkins/post_deploy.sh $SERVICE_HEALTH_URLS $NODES

# -------------------------------------------------------------------------------------------------

