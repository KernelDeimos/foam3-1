p({"class":"foam.nanos.cron.Cron","second":30,"enabled":true,"id":"SMTP Email Service","description":"Re-send UNSENT emails in emailMessageDAO","code":"import foam.dao.DAO;\nimport foam.dao.ArraySink;\nimport foam.nanos.notification.email.EmailMessage;\nimport foam.nanos.notification.email.SMTPEmailService;\nimport foam.nanos.notification.email.Status;\nimport static foam.mlang.MLang.*;\nDAO emailMessageDAO = (DAO) x.get(\"emailMessageDAO\");\nemailMessages = ((ArraySink)\n  emailMessageDAO\n    .where(EQ(EmailMessage.STATUS, Status.UNSENT))\n    .select(new ArraySink()))\n    .getArray();\nemailService = x.get(\"email\");\nfor ( EmailMessage emailMessage : emailMessages ) {\n  emailMessageDAO.put(emailService.sendEmail(x, emailMessage));\n}"})
